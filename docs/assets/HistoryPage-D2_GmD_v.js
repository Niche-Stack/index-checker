import{c as M,j as e,R as I,S as $,A as D,u as H,r as i,q as A,o as R,l as v,e as U,y as Q,z as V,d as _,m as P}from"./index-2OacW39o.js";import{C as E}from"./check-circle-DS0Ylsqm.js";import{f as z}from"./format-B2FXVs-x.js";import{D as W}from"./download-CZ9dQmn_.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=M("ArrowDownUp",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"m21 8-4-4-4 4",key:"1c9v7m"}],["path",{d:"M17 4v16",key:"7dpous"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=M("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),K=({history:r,sites:p,loading:g})=>{const j=t=>{var m;const s=p.find(d=>d.id===t);return s?s.name:((m=r.find(d=>d.siteId===t))==null?void 0:m.siteUrl)||"Unknown Site"},b=(t,s)=>{switch(t){case"check":return s==="successful"||s==="completed_with_errors"?e.jsx(E,{className:"w-5 h-5 text-green-600"}):s==="pending"||s==="processing"?e.jsx(I,{className:"w-5 h-5 text-blue-600 animate-spin"}):e.jsx(D,{className:"w-5 h-5 text-amber-600"});case"reindex":return s==="successful"||s==="completed_with_errors"||s==="no_urls_to_reindex"?e.jsx(E,{className:"w-5 h-5 text-green-600"}):s==="pending"||s==="processing"?e.jsx(I,{className:"w-5 h-5 text-blue-600 animate-spin"}):e.jsx(D,{className:"w-5 h-5 text-red-600"});case"index_request":default:return s==="successful"||s==="pending"||s==="processing"?e.jsx(I,{className:"w-5 h-5 text-blue-600"}):e.jsx(D,{className:"w-5 h-5 text-red-600"})}},f=t=>{switch(t){case"check":return"Check Indexing";case"reindex":return"Request Re-indexing";case"index_request":return"Request Indexing (Legacy)";default:return"Unknown Action"}},N=t=>{switch(t){case"indexed":case"successful":case"no_urls_to_reindex":return"bg-green-100 text-green-800";case"not_indexed":case"completed_with_errors":return"bg-amber-100 text-amber-800";case"pending":case"processing":return"bg-blue-100 text-blue-800";case"failed":case"no_urls_found":return"bg-red-100 text-red-800";default:return"bg-slate-100 text-slate-800"}},x=(t,s)=>{switch(t){case"indexed":return"Indexed (Legacy)";case"not_indexed":return"Not Indexed (Legacy)";case"pending":return"Pending";case"processing":return"Processing";case"successful":return"Successful";case"failed":return"Failed";case"completed_with_errors":return"Completed with Errors";case"no_urls_to_reindex":return"No URLs to Re-index";case"no_urls_found":return"No URLs Found";default:return String(t).replace(/_/g," ").replace(/\b\w/g,w=>w.toUpperCase())}};return g?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(I,{className:"w-6 h-6 text-blue-800 animate-spin mx-auto mb-3"}),e.jsx("p",{children:"Loading history..."})]}):r.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-slate-100 mb-4",children:e.jsx($,{className:"w-6 h-6 text-slate-400"})}),e.jsx("h3",{className:"text-lg font-medium text-slate-800 mb-2",children:"No history found"}),e.jsx("p",{className:"text-slate-500",children:"When you check or request indexing for your pages, the actions will appear here"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50",children:[e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider px-6 py-3",children:"Date"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider px-6 py-3",children:"Site/URL"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider px-6 py-3",children:"Action"}),e.jsx("th",{className:"text-left text-xs font-medium text-slate-500 uppercase tracking-wider px-6 py-3",children:"Status & Message"}),e.jsx("th",{className:"text-right text-xs font-medium text-slate-500 uppercase tracking-wider px-6 py-3",children:"Details"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:r.map(t=>{var s;return e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-slate-700 whitespace-nowrap",children:(s=t.timestamp)!=null&&s.toDate?z(t.timestamp.toDate(),"MMM d, yyyy h:mm a"):"Invalid Date"}),e.jsxs("td",{className:"px-6 py-4 text-sm font-medium text-slate-900",children:[j(t.siteId),t.siteUrl&&e.jsx("div",{className:"text-xs text-slate-500",children:t.siteUrl})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center text-sm text-slate-700",children:[b(t.action,t.status),e.jsx("span",{className:"ml-2",children:f(t.action)})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("span",{className:`block px-2 py-1 text-xs font-medium rounded-full ${N(t.status)} mb-1 w-fit`,children:x(t.status)}),t.message&&e.jsx("p",{className:"text-xs text-slate-500 max-w-xs truncate",title:t.message,children:t.message})]}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-700 text-right whitespace-nowrap",children:[t.action==="check"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[t.indexedItemCount!==void 0?`${t.indexedItemCount} / `:"",t.processedItemCount!==void 0?t.processedItemCount:t.initialItemCount||0," URLs"]}),e.jsx("div",{className:"text-xs",children:t.creditsUsed!==void 0?`${t.creditsUsed} cred.`:t.estimatedCredits?`${t.estimatedCredits} est.`:""})]}),t.action==="reindex"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[t.processedItemCount!==void 0?`${t.processedItemCount} / `:"",t.initialItemCount||0," URLs"]}),e.jsx("div",{className:"text-xs",children:t.creditsUsed!==void 0?`${t.creditsUsed} cred.`:t.estimatedCredits?`${t.estimatedCredits} est.`:""})]})]})]},t.id)})})]})})},X=({children:r})=>e.jsx("span",{style:{padding:"0.25em 0.5em",margin:"0.25em",borderRadius:"0.25em",backgroundColor:"#e0e0e0",color:"#333"},children:r}),Y=({siteUrlFilter:r})=>{const{currentUser:p}=H(),[g,j]=i.useState([]),[b,f]=i.useState(!0),[N,x]=i.useState(null);return i.useEffect(()=>{if(!p){f(!1),x("User not authenticated.");return}f(!0);let t=A(U(_,"pages"),v("userId","==",p.uid),R("lastCheckedAt","desc"));r&&(t=A(U(_,"pages"),v("userId","==",p.uid),v("siteUrl","==",r),R("lastCheckedAt","desc")));const s=Q(t,m=>{const d=m.docs.map(w=>{const l=w.data(),k=l.lastCheckedAt;return{id:w.id,url:l.pageUrl||"",siteUrl:l.siteUrl||"",status:l.status||"N/A",lastCheckedAt:k?k.toDate():null,siteId:l.siteId||"",title:l.title||"",indexed:l.indexed||!1,lastIndexed:null,indexRequested:l.indexRequested||!1,indextimestamp:null}});j(d),f(!1),x(null)},m=>{console.error("Error fetching checked pages:",m),x("Failed to load checked pages. Please try again later."),f(!1)});return()=>s()},[p,r]),b?e.jsx(V,{}):N?e.jsx("div",{className:"text-red-500 text-center p-4",children:N}):g.length===0?e.jsx("div",{className:"text-center p-4",children:"No checked pages found."}):e.jsxs("div",{className:"container mx-auto py-4 sm:py-6 lg:py-8",children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-semibold mb-4 sm:mb-6",children:["Recently Checked Pages ",r&&`for ${r}`]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Page URL"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Parent Site"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Checked"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 max-w-xs truncate",children:e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:t.url})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsx(X,{children:t.status||"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 hidden sm:table-cell",children:t.siteUrl}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.lastCheckedAt instanceof Date?t.lastCheckedAt.toLocaleString():"Invalid Date"})]},t.id))})]})})]})},ae=()=>{const{currentUser:r}=H(),[p,g]=i.useState([]),[j,b]=i.useState([]),[f,N]=i.useState(!0),[x,t]=i.useState(""),[s,m]=i.useState(""),[d,w]=i.useState(""),[l,k]=i.useState("desc");i.useEffect(()=>{if(!r)return;(async()=>{N(!0);try{const n=A(U(_,"sites"),v("userId","==",r.uid)),h=(await P(n)).docs.map(c=>({id:c.id,...c.data()}));b(h);const C=h.map(c=>c.id);if(C.length>0){const c=A(U(_,"indexingHistory"),v("siteId","in",C),R("timestamp","desc")),B=(await P(c)).docs.map(S=>{const y=S.data();return{id:S.id,pageId:y.pageId||"",siteId:y.siteId,timestamp:y.timestamp,action:y.action,result:y.message||"N/A",status:y.status,creditsUsed:y.creditsUsed??y.estimatedCredits??0}}).filter(S=>S.timestamp);g(B)}else g([])}catch(n){console.error("Error fetching history data:",n),g([])}finally{N(!1)}})()},[r]);const L=a=>{const n=j.find(u=>u.id===a);return n?n.name:"Unknown Site"},q=p.filter(a=>{const n=x?L(a.siteId).toLowerCase().includes(x.toLowerCase()):!0,u=s?a.siteId===s:!0,h=d?a.action===d:!0;return n&&u&&h}),T=[...q].sort((a,n)=>{const u=a.timestamp&&typeof a.timestamp.toDate=="function"?a.timestamp.toDate().getTime():0,h=n.timestamp&&typeof n.timestamp.toDate=="function"?n.timestamp.toDate().getTime():0;return l==="asc"?u-h:h-u}),F=()=>{k(a=>a==="asc"?"desc":"asc")},O=()=>{const a=["Date","Site","Action","Result","Credits Used"],n=T.map(o=>[o.timestamp&&typeof o.timestamp.toDate=="function"?o.timestamp.toDate().toISOString():"N/A",L(o.siteId),o.action==="check"?"Check Indexing":"Request Indexing",o.result,o.creditsUsed]),u=[a.join(","),...n.map(o=>o.join(","))].join(`
`),h=new Blob([u],{type:"text/csv;charset=utf-8;"}),C=URL.createObjectURL(h),c=document.createElement("a");c.href=C,c.setAttribute("download",`indexing-history-${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(c),c.click(),document.body.removeChild(c)};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-1",children:"Indexing History"}),e.jsx("p",{className:"text-slate-500",children:"Track all indexing checks and requests"})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsxs("button",{onClick:O,className:"btn-secondary",disabled:q.length===0,children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Export CSV"]})})]}),e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3",children:[e.jsxs("div",{className:"relative flex-grow md:max-w-xs",children:[e.jsx($,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search sites...",className:"input pl-10 w-full",value:x,onChange:a=>t(a.target.value)})]}),e.jsxs("div",{className:"flex-grow md:max-w-xs",children:[e.jsx("label",{htmlFor:"select-site-filter",className:"sr-only",children:"Filter by site"}),e.jsxs("select",{id:"select-site-filter",className:"input w-full",value:s,onChange:a=>m(a.target.value),children:[e.jsx("option",{value:"",children:"All Sites"}),j.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"flex-grow md:max-w-xs",children:[e.jsx("label",{htmlFor:"select-action-filter",className:"sr-only",children:"Filter by action"}),e.jsxs("select",{id:"select-action-filter",className:"input w-full",value:d,onChange:a=>w(a.target.value),children:[e.jsx("option",{value:"",children:"All Actions"}),e.jsx("option",{value:"check",children:"Check Indexing"}),e.jsx("option",{value:"index_request",children:"Request Indexing"})]})]}),e.jsxs("button",{onClick:F,className:"btn-secondary flex items-center",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),l==="desc"?"Newest First":"Oldest First"]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Indexing Actions"}),e.jsxs("div",{className:"flex items-center text-sm text-slate-500",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:"All Time"})]})]}),e.jsx(K,{history:T,sites:j,loading:f})]}),e.jsx("div",{className:"mt-8",children:e.jsx(Y,{})})]})};export{ae as default};
